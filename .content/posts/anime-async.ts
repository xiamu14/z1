export default {
  "filePath": "/Users/ben/Documents/workspace/project/z1/posts/snippets/anime-async.md",
  "content": "<h3>优化异步等待动画的 Hook</h3>\n<pre class=\"shiki shiki-themes min-light min-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#1f1f1f;color:#24292eff;--shiki-dark:#b392f0\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">import</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> { useCallback</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> useEffect</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> useRef</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> useState } </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">from</span><span style=\"color:#22863A;--shiki-dark:#FFAB70\"> 'react'</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">enum</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> State</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  RUNNING</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  FINISHED</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">export</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> default</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> function</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> useAnimeAsync</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">({</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  delay</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  period</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  onRun</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  onFinish</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  debug</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">}</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">:</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  delay</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">:</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> number</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  period</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">:</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> number</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">;</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">  onRun</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">:</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> () </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> void</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">;</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">  onFinish</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">:</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> () </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> void</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  debug</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">?:</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> boolean</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">}) {</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  const</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> [</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">state</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> setState</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">] </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> useState</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">&#x3C;</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">State</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">>();</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  const</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> startRef</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> =</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> useRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">&#x3C;</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">number</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">>(</span><span style=\"color:#1976D2;--shiki-dark:#F8F8F8\">0</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">);</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  const</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> delayRef</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> =</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> useRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">&#x3C;</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">number</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">>(delay);</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  const</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> periodRef</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> =</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> useRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(period);</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  const</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> debugRef</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> =</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> useRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(debug);</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  const</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> startTimerRef</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> =</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> useRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">&#x3C;</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">number</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">>();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  const</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> start</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> =</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> useCallback</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(() </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">    if</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> (state </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">===</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> undefined</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">) {</span></span>\n<span class=\"line\"><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">      startTimerRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> setTimeout</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(() </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">        if</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> (state </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">===</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> undefined</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">) {</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">          setState</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">State</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">RUNNING</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">);</span></span>\n<span class=\"line\"><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">          startRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> Date</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">.now</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">();</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">          onRun</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">();</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">      }</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> delayRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current);</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  }</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> [onRun</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> state]);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">  useEffect</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(() </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">    if</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> (state </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">===</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> State</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">FINISHED</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">) {</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">      if</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> (</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">debugRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">&#x26;&#x26;</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> startRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current) {</span></span>\n<span class=\"line\"><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">        console</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">.log</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(</span><span style=\"color:#22863A;--shiki-dark:#FFAB70\">'--running time'</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> Date</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">.now</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">() </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">-</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> startRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current);</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">      }</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">      onFinish</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">();</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">      setState</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">undefined</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">);</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">      clearTimeout</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">startTimerRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current);</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  }</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> [state</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> onFinish]);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  const</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> stop</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> =</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> useCallback</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(() </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">    if</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> (state </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">===</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> State</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">RUNNING</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">) {</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">      const</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> runTime</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> =</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> Date</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">.now</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">() </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">-</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> startRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current;</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">      const</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> duration</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> =</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">        runTime </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">&#x3C;</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> periodRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">          ?</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> periodRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">-</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> runTime</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">          :</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> periodRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">-</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> (runTime </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">%</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> periodRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current);</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">      if</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> (</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">debugRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current) {</span></span>\n<span class=\"line\"><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">        console</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">.log</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(</span></span>\n<span class=\"line\"><span style=\"color:#22863A;--shiki-dark:#FFAB70\">          '--duration'</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">          runTime</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">          periodRef</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.current </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">%</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> runTime</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">          duration</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">        );</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">      }</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">      if</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> (duration </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">></span><span style=\"color:#1976D2;--shiki-dark:#F8F8F8\"> 0</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">) {</span></span>\n<span class=\"line\"><span style=\"color:#C2C3C5;--shiki-dark:#6B737C\">        // TODO: 完成动画周期</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">        setTimeout</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(() </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">          setState</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">State</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">FINISHED</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">        }</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> duration);</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">      } </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">else</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">        setState</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">State</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">FINISHED</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">      }</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">    } </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">else</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> if</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> (state </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">===</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> undefined</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">) {</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">      setState</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">State</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">.</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">FINISHED</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  }</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> [state]);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  return</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> { stop</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> start };</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">}</span></span></code></pre>\n<h3>🐠 使用方式</h3>\n<pre class=\"shiki shiki-themes min-light min-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#1f1f1f;color:#24292eff;--shiki-dark:#b392f0\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">import</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> { useEffect } </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">from</span><span style=\"color:#22863A;--shiki-dark:#FFAB70\"> 'react'</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">;</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">import</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> useAnimeAsync </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">from</span><span style=\"color:#22863A;--shiki-dark:#FFAB70\"> './use_delay_anime'</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">export</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> default</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\"> function</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> App</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">() {</span></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  const</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> { </span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">start</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> stop</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> } </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> useAnimeAsync</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">({</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">    delay</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">:</span><span style=\"color:#1976D2;--shiki-dark:#F8F8F8\"> 300</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#C2C3C5;--shiki-dark:#6B737C\"> // 设置等待时间 ms</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">    period</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">:</span><span style=\"color:#1976D2;--shiki-dark:#F8F8F8\"> 300</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#C2C3C5;--shiki-dark:#6B737C\"> // 设置动画周期时长 ms</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">    onRun</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">:</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> () </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#C2C3C5;--shiki-dark:#6B737C\">      // 等待时间到达时，没有触发 stop ，则触发</span></span>\n<span class=\"line\"><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">      console</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">.log</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(</span><span style=\"color:#22863A;--shiki-dark:#FFAB70\">'触发动画'</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">    }</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">    onFinish</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">:</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> () </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#C2C3C5;--shiki-dark:#6B737C\">      // stop 触发完成（会补充动画周期）</span></span>\n<span class=\"line\"><span style=\"color:#1976D2;--shiki-dark:#79B8FF\">      console</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">.log</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(</span><span style=\"color:#22863A;--shiki-dark:#FFAB70\">'触发结束'</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">    }</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">    debug</span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">:</span><span style=\"color:#1976D2;--shiki-dark:#79B8FF\"> true</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#C2C3C5;--shiki-dark:#6B737C\"> // 开启会打印时间信息</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">  useEffect</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(() </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">    start</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(); </span><span style=\"color:#C2C3C5;--shiki-dark:#6B737C\">// 启动延迟等待动画</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">    setTimeout</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(() </span><span style=\"color:#D32F2F;--shiki-dark:#F97583\">=></span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">      stop</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">(); </span><span style=\"color:#C2C3C5;--shiki-dark:#6B737C\">// 异步动作完成时停止延迟动画</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">    }</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#1976D2;--shiki-dark:#F8F8F8\"> 400</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">  }</span><span style=\"color:#212121;--shiki-dark:#BBBBBB\">,</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> [stop]);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D32F2F;--shiki-dark:#F97583\">  return</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\"> &#x3C;</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">div</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\"> className</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">=</span><span style=\"color:#22863A;--shiki-dark:#FFAB70\">\"App\"</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">>&#x3C;/</span><span style=\"color:#6F42C1;--shiki-dark:#B392F0\">div</span><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">>;</span></span>\n<span class=\"line\"><span style=\"color:#24292EFF;--shiki-dark:#B392F0\">}</span></span></code></pre>",
  "fileName": "anime-async",
  "subject": [
    "snippets"
  ],
  "md5": "ZHSwCc",
  "frontMatter": {
    "title": "优化异步等待动画的辅助函数",
    "description": "为异步等待动画增加最小显示时间，避免动画闪烁出现消失",
    "cover": "https://images.unsplash.com/photo-1631582053308-40f482e7ace5?q=80&w=3131&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
  },
  "updateAt": 1755865449370
}